{% extends 'base.html' %}
{% block content %}
<h2>Asignar cuadrillas al proyecto</h2>

<h4>{{ proyecto.nombre }}</h4>

<form method="POST">
    {% csrf_token %}
    <div class="form-group mt-3">
        {% for c in cuadrillas_disponibles %}
        <div class="form-check">
            <input 
                class="form-check-input cuadrilla-checkbox" 
                type="checkbox" 
                name="cuadrillas" 
                value="{{ c.id }}"
                id="cuadrilla_{{ c.id }}"
                {% if c.id in cuadrillas_asignadas %}checked{% endif %}>
            <label class="form-check-label" for="cuadrilla_{{ c.id }}">
                {{ c.nombre }} — Líder: {{ c.lider.username|default:"(sin líder)" }}
            </label>
        </div>
        {% endfor %}
    </div>

    <button type="submit" class="btn btn-success mt-3">Guardar cambios</button>
    <a href="{% url 'proyectos:panel' %}" class="btn btn-secondary mt-3">Cancelar</a>
</form>
<script>
    (function(){
        var submitBtn = document.querySelector('form button[type="submit"]');
        function refresh(){
            var any = Array.from(document.querySelectorAll('input.cuadrilla-checkbox')).some(function(chk){ return chk.checked; });
            if(submitBtn){ submitBtn.disabled = !any; }
        }
        function init(){
            document.querySelectorAll('input.cuadrilla-checkbox').forEach(function(chk){
                chk.addEventListener('change', refresh);
            });
            refresh();
        }
        if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init); else init();
    })();
</script>
{% endblock %}
