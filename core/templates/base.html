{% load custom_tags %}
{% load static %}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>La Casa de la Pradera</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    <link rel="stylesheet" href="{% static 'css/sidebar.css' %}">
    <link rel="stylesheet" href="{% static 'css/components.css' %}">
    <link rel="stylesheet" href="{% static 'css/tables.css' %}">
    <link rel="stylesheet" href="{% static 'css/forms.css' %}">
    <style>
    /* MODIFICACIÓN: Forzar estilos del sidebar title con contorno azul y animación */
    .sidebar-title-text {
        display: inline-block !important;
        padding: 10px 20px !important;
        border-radius: 10px !important;
        border: 3px solid #3b82f6 !important;
        background: rgba(59, 130, 246, 0.1) !important;
        color: #1e40af !important;
        font-weight: 700 !important;
        letter-spacing: 0.5px !important;
        animation: titlePulse 2s ease-in-out infinite !important;
        transition: all 0.3s ease !important;
        box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4) !important;
    }
    
    .sidebar-title-text:hover {
        transform: scale(1.05) !important;
        border-color: #1e40af !important;
        background: rgba(59, 130, 246, 0.15) !important;
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3) !important;
    }
    
    @keyframes titlePulse {
        0%, 100% {
            box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4);
            border-color: #3b82f6;
        }
        50% {
            box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
            border-color: #60a5fa;
        }
    }
    </style>
    {% block extra_css %}{% endblock %}
</head>

<body {% if request.user.is_authenticated and request.path != '/usuarios/login/' and request.path != '/accounts/login/' %}class="app-shell"{% endif %}>

{% if request.user.is_authenticated and request.path != '/usuarios/login/' and request.path != '/accounts/login/' %}

<aside class="app-sidebar">
    {# MODIFICACIÓN: Título del sidebar con contorno azul y animación #}
    <div class="sidebar-title">
        <span class="sidebar-title-text">La Casa de la Pradera</span>
    </div>

    <nav>
        <ul class="sidebar-nav">
            {% if request.user|has_group:'JefeProyecto' or request.user|has_group:'LiderCuadrilla' %}
            <li>
                <a href="{% url 'dashboard' %}"
                   {% if request.path == '/' or request.path|slice:":10" == '/dashboard' %}aria-current="page"{% endif %}>Dashboard</a>
            </li>
            <li>
                <a href="{% url 'proyectos:panel' %}"
                   {% if '/proyectos' in request.path %}aria-current="page"{% endif %}>Gestión de proyectos</a>
            </li>
            <li>
                <a href="{% url 'personal:crear_cuadrilla' %}"
                   {% if '/personal' in request.path %}aria-current="page"{% endif %}>Gestión de cuadrillas</a>
            </li>
            {% elif request.user|has_group:'Trabajador' %}
            <li>
                <a href="{% url 'personal:mi_cuadrilla' %}"
                   {% if '/personal/mi-cuadrilla' in request.path %}aria-current="page"{% endif %}>Mi Cuadrilla</a>
            </li>
            {% endif %}
        </ul>
    </nav>
</aside>

<header class="app-header">
    <div class="header-left">
        <span class="badge badge--muted">Entorno</span>
    </div>
    <div class="header-actions">
        <a class="btn btn--ghost" href="{% url 'comunicacion:conversations_list' %}">Conversaciones</a>
        <a class="btn btn--ghost" href="{% url 'personal:mis_notificaciones' %}">
            Notificaciones
            {% if notifs_sin_leer > 0 %}
            <span class="badge badge--danger">{{ notifs_sin_leer }}</span>
            {% endif %}
        </a>
        <span class="badge badge--muted">{{ request.user.first_name }} {{ request.user.last_name }}</span>
        <a href="{% url 'usuarios:logout' %}" class="btn btn--primary">Cerrar sesión</a>
    </div>
</header>

{% endif %}

<main class="app-content">
    {% block content %}{% endblock %}
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
{% block extra_js %}{% endblock %}

</body>
</html>
